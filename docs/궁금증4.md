## ğŸ– ê¶ê¸ˆì¦ 4 : useQuery, useMutationì˜ onSuccessëŠ” ì¤‘ë³µ í˜¸ì¶œë˜ëŠ”ê°€?

### ì»¤ë°‹ ë° ê°œìš”

[ì»¤ë°‹ì€ ìš”ê¸°!](https://github.com/juunzzi/react-query-playground/commit/6ab35643af40f80aa673633c37bd87c35235eebf)

ê¼­ê¼­ í”„ë¡œì íŠ¸ì—ì„œ ì €í¬ëŠ” React Queryë¥¼ ë‹¤ìŒ ê³„ì¸µêµ¬ì¡° ì•„ë˜ì—ì„œ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.

- useQuery, useMutation ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›… ê³„ì¸µ
- useQuery, useMutation ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›… ê³„ì¸µì„ ì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì»¤ìŠ¤í…€ í›… ê³„ì¸µ

ì´ êµ¬ì¡°ì— ì˜í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œê°€ ì‘ì„±ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```jsx
// hooks/queries/post.js
// useQuery, useMutation ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›… ê³„ì¸µì…ë‹ˆë‹¤.

import { useMutation, useQuery } from "react-query";
import { createPost, getPosts } from "../../api/posts";

const key = "posts";

export const useFetchPostList = () => {
  const { data: getPostsResponse, isStale } = useQuery(key, getPosts, {});

  return {
    posts: getPostsResponse?.data ?? [],
    isStale,
  };
};

export const useCreatePostMutation = () => {
  return useMutation(createPost, {
    onSuccess() {
      console.log("Mutation");
    },
  });
};
```

```jsx
// hooks/post/useCreatePost.js
// useQuery, useMutation ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›… ê³„ì¸µì„ ì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í›… ê³„ì¸µì…ë‹ˆë‹¤.

import { useCreatePostMutation } from "../queries/post";

export const useCreatePost = () => {
  const mutation = useCreatePostMutation();

  const createPost = (body) => {
    mutation.mutate(body, {
      onSuccess() {
        console.log("Business");
      },
    });
  };

  return { createPost };
};
```

ì—¬ê¸°ì„œ ê¶ê¸ˆí•œê±´ ë‘ ê°œì˜ ì»¤ìŠ¤í…€ í›…ì—ì„œ ì‘ì„±ëœ onSuccess ë¡œì§ì˜ í˜¸ì¶œ ìˆœì„œì…ë‹ˆë‹¤.

### ê²€ì¦

PostContainer ì»´í¬ë„ŒíŠ¸ì— createPost ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” UIë¥¼ ë Œë”ë§í•˜ê³ , ìƒí˜¸ì‘ìš©í•˜ë©° ì‹¤ì œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ìˆ˜í–‰ ì‹œ `log`ì˜ í˜¸ì¶œ ìˆœì„œë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.

### ê²°ê³¼

```jsx
// hooks/queries/post.js
// useQuery, useMutation ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›… ê³„ì¸µì…ë‹ˆë‹¤.

import { useMutation, useQuery } from "react-query";
import { createPost, getPosts } from "../../api/posts";

const key = "posts";

export const useFetchPostList = () => {
  const { data: getPostsResponse, isStale } = useQuery(key, getPosts, {});

  return {
    posts: getPostsResponse?.data ?? [],
    isStale,
  };
};

export const useCreatePostMutation = () => {
  return useMutation(createPost, {
    onSuccess() {
      console.log("Mutation"); // first
    },
  });
};
```

```jsx
// hooks/post/useCreatePost.js
// useQuery, useMutation ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›… ê³„ì¸µì„ ì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í›… ê³„ì¸µì…ë‹ˆë‹¤.

import { useCreatePostMutation } from "../queries/post";

export const useCreatePost = () => {
  const mutation = useCreatePostMutation();

  const createPost = (body) => {
    mutation.mutate(body, {
      onSuccess() {
        console.log("Business"); // second
      },
    });
  };

  return { createPost };
};
```

ì˜ˆìƒí–ˆë˜ ë°”ì™€ ê°™ì´ useMutationì˜ ì˜µì…˜ìœ¼ë¡œ ë“¤ì–´ê°€ëŠ” onSuccess í•¨ìˆ˜ê°€ ë¨¼ì € í˜¸ì¶œë˜ê³ , useMutation()ì˜ ë°˜í™˜ ê°ì²´ì˜ mutate ë©”ì†Œë“œê°€ ê°–ëŠ” onSuccess í•¨ìˆ˜ê°€ ë‘ë²ˆì§¸ë¡œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
